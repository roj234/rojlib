/*! * FunEx 2.4.9 * (c) Roj234 2021-20XX */!function(e,t){"use strict";var n={module_path:"",prefix:"il_"};function r(){if(!(this instanceof r))throw new Error("Is not a function");this.length=0}function i(e){if(!(this instanceof i))throw new Error("Is not function");if(/^<[a-zA-Z-_]+>$/.test(e))this[0]=document.createElement(e.substring(1,e.length-1)),this.length=1;else{var t=document.createElement("div");t.innerHTML=e,t=t.children,this.length=t.length;for(var n=0;n<t.length;n++)this[n]=t[n]}}function a(e){if("function"==typeof e)return b(e);if(1==arguments.length){if(e instanceof r)return e;if("[object String]"==Object.prototype.toString.call(e)&&e.startsWith("<")&&e.endsWith(">"))return new i(e)}for(var n,a,o=new r,l=0,c=0,f=arguments.length;c<f;c++)if((n=!!s(a=arguments[c])&&("[object String]"==Object.prototype.toString.call(a)?u.ElemSelect2.parse(a):a instanceof Node||a instanceof EventTarget?a:!(!s(a)||!s(a.length))&&Array.from(a)))instanceof Array)for(var d=0;d<n.length;d++)o[""+l++]=n[d];else if(n)o[""+l++]=n;else if((n=arguments[c])instanceof Element)o[""+l++]=n;else if(n instanceof r){if(1==f)return n;o.unionSelf(n)}else null!==arguments[c]&&arguments[c]!==t&&console.warn("Unrecognizable ",arguments[c]);return o.length=l--,o}function s(e){return void 0!==e&&null!=e}function l(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function c(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.prototype[n]=t[n])}function f(t,n,r,i){for(var a,o=!1,s=i?i(t):t.split("."),l=r&&n||e,c=0,f=s.length;c<f;c++)if(a=l,l=l[s[c]],c==f-1&&2==arguments.length)null!=n&&void 0===l&&(a[s[c]]=n,o=!0);else if(void 0===l){if(r)return!1;a[s[c]]=l={}}return o?n:l}r.prototype.toString=function(){return"[FunEx]:"+this.length+" elements."},r.prototype.unionSelf=function(e){var t=this.length;this.length+=e.length;for(var n=0;n<e.length;n++)this[n+t]=e[n];return this._parent=e,this},r.prototype.intersectionSelf=function(e){this.length=0;for(var t=0;0<this.length;o++){var n=this[0];delete this[0],e.includes(n)&&(this[t++]=n,this.length++)}return this._parent=e,this};var u={__MAIN__:{define:m,require:g,defined:s,extend:l,include:c,namespace:f,apply:function(e,t){for(var n in e)t[n]=void 0!==t[n]?t[n]:e[n];return t}},FunExElem:{PF:r.prototype,PE:i.prototype}},d={},h={},p=[];function m(e,n,r){if(s(u[e]))throw new Error("Module "+e+" already loaded.");if("function"!=typeof r)throw new Error("Handler must be a function");if(p.push(e),n instanceof Array){for(var i=[],o=0,c=0;c<n.length;c++){var h=n[c];if("string"==typeof h){var m=g(h,t,null,!0);m instanceof Array?i[c]=m[0]:(m.then(function(e){return function(t){i[e]=t,0==--o&&v(i)}}(c)),o++)}else i[c]=n[c]}0==o&&v(i)}else v([]);function v(n){if("object"!=typeof(r=r.apply(a,n)))throw new Error("Handler() must be object");if(null==r.modules)throw new TypeError("Handler().modules is undefined");var i=function(e){var n;switch(typeof e.parent){case"string":n=f(e.parent,{});break;case"object":case"function":n=e.parent;break;default:if(e.parent===t)return e.modules;throw new Error("handler().parent must be string or object! Got: "+e.parent)}if("object"!=typeof e.modules)throw new Error("Invalid handler().modules! Got "+e.modules);if(n instanceof Array){for(var r=0;r<n.length;r++)switch(typeof n[r]){case"string":n[r]=f(n[r],{});break;case"object":case"function":break;default:throw new Error("Invalid handler().parent["+r+"]! Got: "+n[r])}for(r=0;r<n.length;r++)l(n[r],e.modules)}else l(n,e.modules);return e.modules}(r);if(void 0!==d[e]){for(var o=d[e],s=0;s<o.length;s++)o[s](i);delete d[e]}u[e]=i}}function v(e,t){void 0===u[e]?(d[e]||(d[e]=[]),d[e].push(t)):t(u[e])}function g(t,r,i,a){var o,l=[];if(t instanceof Array)o=t;else{if(null==t)throw new TypeError("name should be array or string");o=[t]}s(i)||(i=n.module_path);for(var c=o.length,f=0;f<o.length;f++){var d=u[o[f]];s(d)&&(l[f]=d,c--)}return a&&0==c?(s(r)&&r(l),l):new Promise(function(n,a){if(0==c)return n.apply(e,l),void(s(r)&&r.apply(e,l));for(var f=0;f<o.length;f++)if(void 0===l[f]){var u=h[o[f]];if(-1===u)return void a("Module "+o[f]+" was failed to load");if(h[o[f]]=1,v(o[f],function(t){return function(i){l[t]=i,delete h[o[t]],--c<=0&&(n.apply(e,l),s(r)&&r.apply(e,l))}}(f)),!u){var d={url:i+"/"+o[f]+".js",success:function e(t){try{Function("define",t)(m)}catch(t){return void a("Invalid module "+e.name1,t)}p.includes(e.name1)||a("Invalid module "+e.name1),p=[]},error:function e(n,r,i){a("Module "+t+": network error: "+r),h[e.name1]=-1}};d.error.name1=d.success.name1=o[f],$.ajax(d)}}})}m.amd=!1,g.sync=function(e,t,n){var r=g(e,t,n,!0);return 1==r.length?r[0]:r},l(e,{FunEx:a,$:a,define:m,require:g,defined:s,EMPTY_FN:function(){}}),l(e.FunEx,{config:n,version:"2.4.9",extend:l,include:c,module:m,require:g,namespace:f});var y="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function b(e){b.loaded?b.loaded.push(e):e()}b.loaded=[],l(e.FunEx,{uuid:function(e,t){var n,r,i=[];if(t=t||y.length,e)for(n=0;n<e;n++)i[n]=y[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;n<36;n++)i[n]||(r=0|16*Math.random(),i[n]=y[19==n?3&r|8:r]);return i.join("")},callOnly:function(e,t){if(!Object.defineProperty)if(Object.__defineGetter__)for(var n in t)Object.__defineGetter__(t[n],function(e){return function(){return e}}(e[t[n]]));else alert("请更换浏览器");for(var n in t)Object.defineProperty(e,t[n],{enumerable:!1})},readOnly:function(e,t){if(!Object.defineProperty)if(Object.__defineGetter__)for(var n in t)Object.__defineGetter__(t[n],function(e){return function(){return e}}(e[t[n]]));else alert("请更换浏览器");for(var n in t)Object.defineProperty(e,t[n],{configurable:!1,enumerable:!1})},onReady:b})}(window),define("Lexer",[],function(){"use strict";var e=r("0123456789"),t=r(" \r\n\t"),n=r("+-\\/*()!~`@#$%^&=,<>.?\"':;|[]{}");function r(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;return t}function i(e){this.input=e,this.index=0,this.found=Array(1),this.last={index:-1}}return i.prototype.init=function(e){return this.input=e,this.index=0,this.found[0]=null,this.last.index=-1,this},i.prototype.retract=function(e){if(e=null==e?1:e,this.index<e)throw new Error("无法回退");this.index-=e},i.prototype.retractWord=function(){this.restore(this.last),this.last.index=-1},i.prototype.snapshot=function(e){return e.index=this.index,e},i.prototype.nextWord=function(){return this.snapshot(this.last),this.readWord()},i.prototype.formClip=function(e,t){return{type:e,val:t}},i.prototype.eof=function(){return{type:-1,val:"/EOF"}},i.prototype.readAlphabet=function(){for(var e="";this.hasNext();){var r=this.next();if(n[r]||t[r]){this.retract();break}e+=r}return 0==e.length?this.eof():this.formClip(0,e)},i.prototype.readSpecial=function(){throw new SyntaxError("子类需要重写此方法")},i.prototype.readWord=function(){for(;this.hasNext();){var r=this.next();switch(r){case"'":case'"':return this.formClip(1,this.readSlashString(r));case"/":var i=this.ignoreStdNote();if(null!=i)return i;break;default:if(!t[r]){if(this.retract(),n[r]){switch(r){case"+":this.next();case"-":return this.readDigit()}return this.readSpecial()}return e[r]?this.readDigit():this.readAlphabet()}}}return this.eof()},i.prototype.ignoreStdNote=function(){if(this.hasNext())switch(this.next()){case"/":for(;this.hasNext()&&"\n"!=this.next(););break;case"*":for(;this.hasNext();)if("*"==this.next()){if(!this.hasNext())return this.eof();if("/"==this.next())break}break;default:return this.retract(2),this.readSpecial()}return this.hasNext()?null:this.eof()},i.prototype.readDigit=function(){for(var t,n="",r=0;this.hasNext();){if("."==(t=this.next())?(0!=(1&r)&&this.error("未预料到的'.'"),r=1):"-"==t&&(0!=r&&this.error("未预料到的'-'"),r|=2),!e[t]&&"."!=t&&"-"!=t){this.retract();break}n+=t}if(0==n.length)return this.eof();var i=n.charAt(n.length-1);return e[i]||this.error("未预料的'"+i+"'"),this.formClip(2+r,n)},i.prototype.restore=function(e){e.index<0||(this.index=e.index)},i.prototype.offset=function(e){return this.input.charAt(this.index+e)},i.prototype.hasNext=function(){return this.index<this.input.length},i.prototype.next=function(){return this.input.charAt(this.index++)},i.prototype.readSlashString=function(e){this.input;var t=this.found;t[0]="";var n,r=!1;e:for(;this.hasNext();)if(n=this.next(),r)this.index=this.slashHandler(n,t,this.index),r=!1;else switch(n){case"'":case'"':if(e==n){e=null;break e}t[0]+=n;break;case"\\":r=!0;break;default:t[0]+=n}return r&&this.error("未终止的'\\'"),null!=e&&this.error("未终止的'"+e+"'"),t[0]},i.prototype.slashHandler=function(e,t,n){switch(e){case"'":case'"':case"\\":t[0]+=e;break;case"n":t[0]+="\n";break;case"r":t[0]+="\r";break;case"t":t[0]+="\t";break;case"b":t[0]+="\b";break;case"f":t[0]+="\f";break;case"u":var r=parseInt(this.input.substring(this.index,this.index+4),16);n+=4,t[0]+=String.fromCharCode(r);break;default:this.error("未预料的'\\'")}return n},i.prototype.error=function(e){for(var t,n="",r=1,i=0;i<this.index;i++){switch(a=this.input.charAt(i)){case"\r":"\n"==this.input.charAt(i+1)&&r++;case"\n":r++,n="";break;default:n+=a}}t=n.length;e:for(;i<this.input.length;i++){var a;switch(a=this.input.charAt(i)){case"\r":case"\n":break e;default:n+=a}}throw n.length&&(console.log(n),console.log(Array(t).join("-")+"^")),new Error(e+" 在第"+this.index+"个字符(第"+r+"行的字符"+t+")")},{modules:{Lexer:i,addSlashes:function(e){for(var t=String(e),n=0;n<t.length;n++)switch(t.charAt(n)){case"\\":case'"':t=t.substring(0,n)+"\\"+t.substring(n++);break;case"\n":t=t.substring(0,n++)+"\\n"+t.substring(n);break;case"\r":t=t.substring(0,n++)+"\\r"+t.substring(n);break;case"\t":t=t.substring(0,n++)+"\\t"+t.substring(n);break;case"\b":t=t.substring(0,n++)+"\\b"+t.substring(n);break;case"\f":t=t.substring(0,n++)+"\\f"+t.substring(n)}return t},HashSet:r,VARIABLE:0,STRING:1,INTEGER:2,DECIMAL:3,EOF:-1,NUMBER:e,WHITESPACE:t,SPECIAL:n}}}),define("ElemSelect2",["Lexer"],function(e,t){"use strict";var n=10,r=11,i=12,a=13,o=14,s=15,l=16,c=17,f=18,u=19,d=20,h=21,p=22,m=23,v=24;function g(t){e.Lexer.call(this,t)}$.include(g,e.Lexer.prototype);var y=e.HashSet("+\\/*()!~`@#$%^&=,<>.?\"':;|[]{}");function b(l,c){for(var f,u,d=0;l.hasNext();)switch((f=l.nextWord()).type){case s:break;case v:switch((f=w(l,e.VARIABLE)).val){case"focus":u=!document.hasFocus||document.hasFocus()?[document.activeElement]:[];break;default:_(l,f.val)}break;case n:case a:var h=w(l,e.VARIABLE);if(f.type==n){var p=_$(h.val);u=null==p?[]:[p]}else u=document.getElementsByClassName(h.val);case i:u==t&&_(l,f.val),u=x(u,l);for(var m=0;m<u.length;m++)c.push(u[m]);d=0;break;case r:case e.VARIABLE:u=x(document.getElementsByTagName(f.val),l);for(m=0;m<u.length;m++)c.push(u[m]);d=0;break;case e.EOF:return c;case o:if(d-- >0)break;default:return void _(l,"'"+f.val+"'")}}function w(e,t){var n=e.nextWord();return n.type!=t&&_(e,n.val),n}function x(i,g){var y,b,x=!0;function E(e){b=[];for(var t=0;t<i.length;t++)e(t,i[t])==x&&b.push(i[t]);i=b}for(;;){switch((y=g.nextWord()).type){case v:switch((O=w(g,e.VARIABLE)).val){case"before":case"after":_(g,O.val,"Pseudo elements are not supported as they are not REAL elements in document!");break;case"prev":case"next":O="prev"==O.val,b=[];for(var S=0;S<i.length;S++){var T=i[S][O?"previousSibling":"nextSibling"];defined(T)&&b.push(T)}i=b;break;case"nth":case"eq":w(g,p);var A=w(g,e.VARIABLE).val;isNaN(A)&&_(g,A,"数字"),A=parseInt(A),w(g,m),i=A>=0&&i.length>A?[i[A]]:[];break;case"focus":!document.hasFocus||document.hasFocus()?E(function(e,t){return t===document.activeElement}):i=[];break;case"selected":case"checked":E(function(e,t){return t[O.val]});break;case"enabled":case"disabled":A="enabled"!=y.val;E(function(e,t){return t.disabled==A});break;case"first":i.length>1&&(i=[i[0]]);break;case"last":i.length>1&&(i=[i[i.length-1]]);break;case"even":case"odd":A="even"==y.val?1:0;E(function(e){return(1&e)==A});break;default:_(g,y.val)}break;case l:console.warn("& is depercated!");break;case r:break;case e.VARIABLE:y=y.val.toUpperCase(),E(function(e,t){return t.nodeName==y});break;case u:b=[];for(S=0;S<i.length;S++){T=i[S].parentElement;defined(T)&&b.push(T)}i=b;break;case s:b=[];for(S=0;S<i.length;S++)for(var L=i[S].children,I=0;I<L.length;I++)b.push(L[I]);i=b;break;case p:var O,C,M=0;b=[];e:for(;;)switch((O=g.nextWord()).type){default:_(g,O.val);case e.EOF:_(g,"EOF");case m:break e;case e.VARIABLE:0==M?(isNaN(O.val)&&_(g,O.val,"数字"),C=O=parseInt(O.val),defined(i[O])&&b.push(i[O]),M=1):_(g,O.val);break;case o:1==M?M=0:_(g,"','","数字");break;case h:if(1==M&&C!=t)for(O=g.nextWord(),isNaN(O.val)&&_(g,O.val,"数字"),O=parseInt(O.val),O=Math.min(O,i.length),C++;C<=O;C++)defined(i[C])&&b.push(i[C]);else _(g,"'..'")}i=b;break;case n:case a:M=w(g,e.VARIABLE);y.type==n?E(function(e,t){return t.id==M.val}):E(function(e,t){return t.classList&&t.classList.contains(M.val)});break;case c:var N=w(g,e.VARIABLE).val;w(g,f);var j=w(g,e.VARIABLE).val;E(function(e,t){return F_DOM.getData(i[e],N)==j});break;case d:if(x){x=!1;continue}case o:case e.EOF:return i&&i.length?k(i):[];default:_(g,y.val)}x=!0}}g.prototype.readWord=function(){for(var t=!1;this.hasNext();){var n=this.next();switch(n){case"'":case'"':return this.formClip(e.VARIABLE,this.readSlashString(n));default:if(!e.WHITESPACE[n])return this.retract(),t?this.formClip(s," "):y[n]?this.readSpecial():this.readAlphabet();t=!0}}return this.eof()},g.prototype.readAlphabet=function(){for(var t="";this.hasNext();){var n=this.next();if(y[n]||e.WHITESPACE[n]){this.retract();break}t+=n}return 0==t.length?this.eof():this.formClip(e.VARIABLE,t)},g.prototype.readSpecial=function(){var e,t=this.next();switch(t){case":":e=v;break;case"(":e=p;break;case")":e=m;break;case"#":e=n;break;case"*":e=r;break;case"<":e=i;break;case".":"."==this.offset(0)?(this.next(),e=h):e=a;break;case",":e=o;break;case"&":e=l;break;case"$":e=c;break;case"=":e=f;break;case"^":e=u;break;case"!":e=d;break;default:this.error("无效字符 '"+t+"'")}return this.formClip(e,t)};var E="_IAR"+Math.random().toString(36);function k(e){for(var t=Array(e.length),n=0,r=0;r<e.length;r++)e[r][E]||((t[n++]=e[r])[E]=1);for(t.length=n,r=0;r<n;r++)delete t[r][E];return t}function _(e,t,n){console.error(e),e.error("未预料的: "+t+(n?", 期待: "+n:""))}var S=new g,T=!1,A=0;function L(e){return A++,T?(console.warn("Lexer concurrent?",A),(new g).init(e)):(T=!0,S.init(e))}function I(e){e==S&&(T=!1)}return{modules:{parse:function(e){var t=L(e),n=[];try{b(t,n),t.hasNext()&&t.error("期待 /EOF")}finally{I(t)}return n},filter:function(e,t){var n=L(t);try{return x(e,n)}finally{I(n)}},esRead:b,esFilter:x,retainLexer:L,releaseLexer:I}}}),define("Title",[],function(){"use strict";var e=document.title;return{parent:"FunEx.Title",modules:{set:function(t){document.title=t+" - "+e},reset:function(){document.title=e}}}}),define("ResourceLoader",[FunEx],function(e){"use strict";var t;return e.onReady(function(){t=e("<div>").id("_FunExRes").appendTo(e("head"))}),{parent:FunEx,modules:{loadScript:function(n,r,i,a,o){var s=e("<script>").type("text/javascript");"function"!=typeof r&&(r=EMPTY_FN);var l=s[0];s.one("readystatechange load",function(e){defined(l.readyState)&&"loaded"!=l.readyState&&"complete"!=l.readyState||(r(),this.remove())},!0),o&&o.call&&s.once("error",o),i?s.html(n):l.src=n+(a?"?r="+Math.random():""),s.appendTo(t)},loadStyle:function(n,r,i,a,o){a=!a;var s=e(i?"<style>":"<link>");if(r){var l=s[0];s.one("readystatechange load",function(){defined(l.readyState)&&"loaded"!=l.readyState&&"complete"!=l.readyState||r()})}o&&o.call&&s.once("error",o),s.type("text/css"),i?s.html(n):(s[0].rel="stylesheet",s[0].href=n),s.appendTo(a?t:e("head"))},clearRes:function(){for(var e=0;e<t.children.length;e++){var n=t.children[e];"function"==typeof n.remove&&n.remove()}}}}}),define("Ajax",["ResourceLoader","__MAIN__"],function(e,t){"use strict";var n=[],r=null;function i(e){for(var t=0;t<n.length;t++)if(4==n[t].readyState&&n[t].responseType==e)return n[t];n.length>16&&(n.length=16);var r=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else for(var t=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(e){}if(!defined(e))throw new Error("No XHR found");null==e.readyState&&(e.readyState=0,e.addEventListener("load",function(){e.readyState=4,"function"==typeof e.onreadystatechange&&e.onreadystatechange()},!1));return e}();return n.push(r),r.responseType=e,r}function a(e){return Object.keys(e).map(function(t){return{k:t,v:e[t]}})}function o(e,t,n,o){if(e.noCache&&(t.includes("?")?t+="&r="+Math.random():t+="?r="+Math.random()),"jsonp"!=e.dataType){var s=!1,l=i(e.responseType);l.timeout=e.timeout,l.onerror=function(e){s||(o(l,l.statusText,e),s=!0)},l.onreadystatechange=function(){if(l.readyState==l.DONE){if(200==l.status||304==l.status)switch(e.dataType){case"text":e.success(l.response,l.statusText);break;case"custom":if(r){r(l,e);break}case"json":var t;try{t=JSON.parse(l.response),e.success(t,l.statusText)}catch(e){s||(o(l,l.statusText,e),s=!0)}}else o(l,l.statusText,l.status),s=!0;e.complete(l)}};try{l.open(e.method,t,e.async);var c=e.header;for(var f in c)l.setRequestHeader(f,c[f]);if("post"==e.method.toLowerCase()){u=e.beforeSend(l,n);if(!defined(u))if("[object Object]"!=Object.prototype.toString.call(n))u=n;else{if("object"==typeof n){n=a(n),u="";for(h=0;h<n.length;h++)u+=n[h].k+"="+String(n[h].v).replaceAll("&","%26")+"&";u.length>0&&(u=u.substring(0,u.length-1))}l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}l.send(defined(u)?u:null)}else l.send(null)}catch(e){s||(o(l,l.statusText,e),s=!0)}}else{var u,d="FeAjax"+Math.abs(1e10*Math.random()|0).toString(10);if(window[d]=function(t){e.success(t,"200 OK"),e.complete(null),delete window[d]},"object"==typeof n){n=a(n),u="";for(var h=0;h<n.length;h++)u+=n[h].k+"="+String(n[h].v).replaceAll("&","%26")+"&";u.length>0&&(u=u.substring(0,u.length-1))}else u=n;function p(t){o(t),e.complete(null)}$.loadScript(t+(t.includes("?")?"&callback=":"?callback=")+d+(u?"&"+u:""),function(){window[d]&&p("Invalid jsonp data")},!1,!1,p)}}var s={method:"get",dataType:"text",responseType:"text",data:!1,async:!0,timeout:1e4,noCache:!1,header:{},error:EMPTY_FN,complete:EMPTY_FN,success:EMPTY_FN,beforeSend:EMPTY_FN};function l(e,n){"string"==typeof e&&(e={url:e,onSuccess:n}),t.apply(s,e),o(e,e.url,e.data,e.error)}return l.config=s,l.setCustomHandler=function(e){r=e},{parent:"FunEx",modules:{ajax:l,asyncAjax:function(e){return"string"==typeof e&&(e={url:e}),t.apply(s,e),new Promise(function(t,n){e.success==EMPTY_FN&&(e.success=t),o(e,e.url,e.data,n)})}}}}),define("DOM",[FunEx,window],function(e,t){"use strict";var n=!1;try{var r=Object.defineProperty({once:!0},"passive",{get:function(){return n=!0,!0}});t.addEventListener("mousemove",null,r)}catch(e){}return e.extend(t,{_$:function(e){return document.getElementById(e)}}),{parent:"F_DOM",modules:{getData:function(e,t){var n=e.getAttribute(t);return defined(n)?n:""},setData:function(e,t,n){e.setAttribute(t,n)},removeData:function(e,t){e.removeAttribute(t)},style:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null)[t]},hide:function(e){e.style.display="none"},toggle:function(e){e.style.display="none"==e.style.display?"block":"none"},show:function(e,t){e.style.display=defined(t)?t:"block"},remove:function(e,t){defined(t)?e.removeChild(t):e.parentElement?e.parentElement.removeChild(e):e.remove()},canOnce:n,hasClass:function(e,t){return e.classList.contains(t)},addClass:function(e,t){t=t.split(" "),e.classList.add.apply(e.classList,t)},toggleClass:function(e,t,n){t=t.split(" ");var r=e.classList;if(void 0!==n)r[n?"add":"remove"].apply(r,t);else for(var i in t)r[r.contains(t[i])?"remove":"add"](t[i])},removeClass:function(e,t){t=t.split(" "),e.classList.remove.apply(e.classList,t)},bind:function(e,t,r,i,a){i?e.addEventListener(t,r,{once:!0}):e.addEventListener(t,r,n&&"object"==typeof a?{passive:!!a.passive,useCapture:!!a.useCapture}:a)},unbind:function(e,t,n,r){defined(n)?e.removeEventListener(t,n,!!r):delete e["on"+t]||delete e[t]},stopEvent:function(e){!1!==(e=e||t.event).cancelable&&e.preventDefault(),e.stopPropagation()}}}}),define("ChainOp",[FunEx,"ElemSelect2","ResourceLoader","FunExElem","DOM"],function(e,t,n,r,i){"use strict";function a(e,t){if(e.length)for(;t;){for(var n=0;n<e.length;n++)if(t==e[n])return n;t=t.parentElement}else for(;t;){if(t==e)return!0;t=t.parentElement}return!1}function o(e,t,n,r,a){2==arguments.length?e.dispatchEvent(new Event(t)):i.bind(e,t,n,!!r,a)}function s(){for(var t=[],n=0;n<arguments.length;n++){var r=parseInt(arguments[n],10);r>=0&&r<this.length&&t.push(this[r])}return(t=e(t))._parent=this,t}function l(n,r){r=r?this:this.children();var i=t.filter(r,n);return(i=e(i))._parent=this,i}function c(t){return function(){var n=Array.from(arguments);n.unshift(void 0);var r=this;if(!r.length)return n.length>2?r:null;var i=0;if(defined(t.animated)&&(n[0]=null,i=parseInt(t.apply(r,n),10),i=isNaN(i)?0:i),defined(r._delay)){defined(r._chained)?r._chained.push([r,t,n]):setTimeout(function(e,t,n){for(var i=0;i<e.length;i++)n[0]=e[i],t.apply(r,n)},r._delay,r,t,n)}else{for(var a=[],o=0;o<r.length;o++)n[0]=r[o],a.push(t.apply(r,n));if(void 0!==a[0])return 1==a.length?a[0]:a}if(0!=i){var s=e();return s.unionSelf(r),s._delay=(r._delay||0)+i,s}return r}}function f(e,t){if(t instanceof Node)e.appendChild(t);else if("string"==typeof t)e.insertAdjacentHTML("beforeEnd",t);else if(t.each&&t[0]instanceof Node)for(var n=0;n<t.length;n++)e.appendChild(t[n]);else console.warn("Illegal append",t,"to",e)}function u(e,t,n){if(arguments.length>=3)i.setData(e,t,n);else{if(null!=t.length)return i.getData(e,t);for(var r in t)i.setData(e,r,t[r])}}function d(e){this.prevElement=e}var h='',p=!1;function m(){p||e.loadStyle(h,!1,!0,!0),p=!0}function v(e){var t,n=this;return n._chained.length&&(t=setTimeout(function(e){for(var t=0;t<e.length;t++)for(var r=e[t],i=r[0],a=r[1],o=r[2],s=0;s<i.length;s++)o[0]=i[s],a.apply(n,o)},n._delay,n._chained)),delete n._chained,e?t:n}function g(t){t="fex_anim fex_anim_"+t;var n=function(n,r,i){if(null===n)return r;defined(n.__fex_anim_timeId)&&clearTimeout(n.__fex_anim_timeId),m(),n.__fex_anim_timeId=e(n).addClass(t).css("animation-duration",r+"ms").show().if(defined(i)).css("animation-timing-function",i).endif().delay(r,!0).removeClass(t).finish(1)};return n.animated=!0,n}function y(t){t="fex_anim fex_anim_"+t;var n=function(n,r,i){if(null===n)return r;defined(n.__fex_anim_timeId)&&clearTimeout(n.__fex_anim_timeId),m(),n.__fex_anim_timeId=e(n).addClass(t).css("animation-duration",r+"ms").if(defined(i)).css("animation-timing-function",i).endif().delay(r,!0).hide().removeClass(t).finish(1)};return n.animated=!0,n}var b={innerHTML:!0,innerText:!0,parentElement:!0,parentNode:!0};var w=function(){return this};var x=function(e){var t=[HTMLDivElement,HTMLScriptElement,HTMLInputElement],n=[document.createElement("div"),document.createElement("script"),document.createElement("input")];for(var r in t){var i=t[r];if(defined(i))for(var a in i.prototype)if(!defined(e[a]))try{i.prototype[a]}catch(t){if(a.startsWith("on")||b[a]||a.startsWith("client")||a.startsWith("offset"))continue;try{if(n[r][a]="/wsl","/wsl"!=n[r][a]&&!0!==n[r][a])continue;e[a]=function(e){return function(t,n){if(!defined(n))return t[e];t[e]=n}}(a)}catch(t){e[a]=function(e){return function(t){return t[e]}}(a)}}}return e}({removeAttr:function(e,t){i.removeData(e,t)},data:function(e,t,n){return arguments.length>2?u(e,"data-"+t,n):u(e,"data-"+t)},attr:u,prop:function(e,t,n){if(arguments.length>=3)e[t]=n;else{if(null!=t.length)return e[t];for(var r in t)e[r]=t[r]}},getStyle:i.getStyle,hasClass:i.hasClass,addClass:i.addClass,toggleClass:i.toggleClass,removeClass:i.removeClass,append:f,prepend:function(e,t){if(t instanceof Node)e.prepend(t);else if("string"==typeof t)e.insertAdjacentHTML("afterBegin",t);else if(t.each&&t[0]instanceof Node)for(var n=t.length-1;n>=0;n--)e.prepend(t[n]);else console.warn("Illegal prepend",t,"to",e)},insert:function(e,t,n){e.insertBefore(n,e.children[t])},insertBefore:function e(t,n){if(defined(n.parentElement))n.parentElement.insertBefore(t,n);else if("string"==typeof n)t.insertAdjacentHTML("beforeBegin",n);else{if(n.each&&n[0]instanceof Node)return n.each(function(n){e(t,n)});console.warn("Illegal insertBefore",t,"to",n)}},insertAfter:function(e,t){f(t[0]?t.parent()[0]:t.parentElement,e)},on:o,delegate:function(t,n,r,a,o,s){n=n.split(" ");for(var l=function(n){var i=n.target;if(defined(i)){var o=e(i);return o.findSelf(r).length?a.call(o,n,function(){return e(t).find(r).index(i)}):void 0}},c=0;c<n.length;c++)i.bind(t,n[c],l,!!o,s)},delegateChild:function(t,n,r,o,s,l){n=n.split(" ");for(var c=function(n){var i=n.target;if(defined(i)){for(var s,l=e(i),c=!1;i&&i!=t;){if(l[0]=i,(s=l.findSelf(r)).length>0){c=!0;break}i=i.parentElement}if(i&&c){var f=a(s,n.target);if(!1!==f)return n.delegatedTarget=s[f],o.call(l,n,function(){return e(t).find(r).index(i)})}}},f=0;f<n.length;f++)i.bind(t,n[f],c,!!s,l)},bind:o,all:function(e,t,n,r,i){t=t.split(" ");for(var a=0;a<t.length;a++)o(e,t[a],n,r,i)},one:function(e,t,n,r,i){t=t.split(" ");for(var a=0;a<t.length;a++)if(void 0!==e["on"+t[a]])return void o(e,t[a],n,r,i)},once:function(e,t,n,r){if(!i.canOnce){var a=n;n=function(){i.unbind(e,t,a),a.apply(null,arguments)}}o(e,t,n,!0,r)},unbind:i.unbind,css:function(e,t,n){if(defined(n))e.style[t]=n;else{if("string"==typeof t)return e.style[t];if(defined(t))for(var r in t)e.style[r]=t[r]}},empty:function(e){e.innerHTML=""},html:function(e,t){if(!defined(t))return e.innerHTML;t instanceof Node?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},text:function(e,t){if(!defined(t))return e.innerText||e.textContent;defined(e.innerText)?e.innerText=t:e.textContent=t},val:function(e,t){if(!defined(t))return e.value;e.value=t},width:function(t,n){return defined(t.width)?defined(n)?void(t.width=n):t.width:defined(n)?void e(t).css("width",n+"px"):t===document?document.children[0].clientWidth:t===window?window.innerWidth:t.clientWidth},height:function(t,n){return defined(t.height)?defined(n)?void(t.height=n):t.height:defined(n)?void e(t).css("height",n+"px"):t===document?document.children[0].clientHeight:t===window?window.innerHeight:t.clientHeight},outerWidth:function(e,t){var n=e.computedStyleMap();return e.clientWidth+n.get("margin-left").value+n.get("margin-right").value+n.get("border-left-width").value+n.get("border-right-width").value},outerHeight:function(e,t){var n=e.computedStyleMap();return e.clientHeight+n.get("margin-top").value+n.get("margin-bottom").value+n.get("border-top-width").value+n.get("border-bottom-width").value},innerWidth:function(e,t){return e.clientWidth},innerHeight:function(e,t){return e.clientHeight},hide:i.hide,toggle:i.toggle,show:i.show,remove:i.remove,removeChildren:function(e){for(;e.childElementCount>0;)e.removeChild(e.children[e.childElementCount-1])},trigger:function(e,t){defined(e[t])&&e[t]()},focus:function(e){e.focus()},select:function(e){e.select()},position:function(e){return{top:e.top,left:e.left,width:e.width,height:e.height}},offset:function(e){return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}},client:function(e){return{top:e.clientTop,left:e.clientLeft,width:e.clientWidth,height:e.clientHeight}},scrollTop:function(e,t){if(!defined(t))return defined(e.scrollingElement)?e.scrollingElement.scrollTop:e.scrollTop;defined(e.scrollingElement)?e.scrollingElement.scrollTop=t:e.scrollTop=t},scrollLeft:function(e,t){if(!defined(t))return defined(e.scrollingElement)?e.scrollingElement.scrollLeft:e.scrollLeft;defined(e.scrollingElement)?e.scrollingElement.scrollLeft=t:e.scrollLeft=t},scrollHeight:function(e){return e.scrollHeight},fadeIn:g("fadeIn"),fadeOut:y("fadeOut"),zoomIn:g("zoomIn"),zoomOut:y("zoomOut"),animate:function(t,n,r){if(null===t)return r;e(t).css("transition","all "+r+"ms").delay(1).css(n)}});x.animate.animated=!0;var E,k={each:function(e){for(var t=0;t<this.length;t++)if(!1===e.call(this[t],t,this[t]))return this;return this},children:function(){for(var t,n=[],r=0;r<this.length;r++)if(t=this[r].children,defined(t))for(var i=0;i<t.length;i++)n.push(t[i]);var a=e(n);return a._parent=this,a},findSelf:function(e){return l.call(this,e,!0)},find:l,findAll:function(n){for(var r,i=[],a=t.retainLexer(n),o=this;o.length>0;){o=o.children(),r=t.esFilter(o,a.init(n));for(var s=0;s<r.length;s++)i.push(r[s])}return t.releaseLexer(a),(i=e(i))._parent=this,i},delay:function(t,n){this._chained&&v.call(this);var r=e();return r.unionSelf(this),r._delay=t,defined(this._delay)&&(r._delay+=this._delay),n&&(r._chained=[]),r},finish:v,eq:function(e){return s.call(this,e)},only:s,with:function(t){return this.unionSelf(e(t))},instant:function(){return delete this._delay,this},index:function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1},parent:function(t){t=t||1;for(var n,r,i=Array(this.length),a=0,o=0;o<this.length;o++){for(n=this[o],r=t;r-- >0&&n;)n=n.parentElement;n?i[a++]=n:i.length--}return(i=e(i))._parent=this,i},child:function(t){t=t||0;for(var n=[],r=0;r<this.length;r++)t>=0&&t<this[r].childElementCount&&n.push(this[r].children[t]);return(n=e(n))._parent=this,n},appendTo:function(t){return e(t).append(this[0]).length>1?null:e(this[0])},prependTo:function(t){return e(t).prepend(this[0]).length>1?null:e(this[0])}},_={if:function(e){return e?this:new d(this)},else:function(){return this instanceof d?this.prevElement:new d(this)},elseif:function(e){return this instanceof d?e?this.prevElement:this:new d(this)},endif:function(e){return this instanceof d?this.prevElement:this}};return Element.prototype.isSameSource=function(e){return a(this,e)},e.callOnly(Element.prototype,["isSameSource"]),e.extend(r.PF,E=function(e){var t={};for(var n in e)t[n]=c(e[n]);return t}(x)),e.extend(r.PE,E),e.extend(r.PF,k),e.extend(r.PE,k),e.extend(d.prototype,function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=w}return e}(x,k)),e.extend(r.PF,_),e.extend(r.PE,_),e.extend(d.prototype,_),{modules:{}}}),define("Storage",[FunEx],function(e){"use strict";var t,n,r,i=function(t){return""!=t?e.config.prefix+t:t},a=(t={},n=function(){t={};for(var e=document.cookie.split("; "),n=0;n<e.length;n++){var r=e[n].split("=");t[r[0]]=unescape(r[1])}return t},{get:function(e,r){return n(),void 0===(e=i(e))?t:defined(t[e])?t[e]:r},set:function(e,t,n){e=i(e);var r=escape(e)+"="+escape(t);null!=n&&(r+="; expires="+new Date(Date.now()+1e3*n-TIMEZONE_OFFSET).toGMTString()),document.cookie=r},del:r=function(e){e=i(e),document.cookie=e+"=;expires="+new Date(0).toGMTString()},clear:function(){for(var e in n(),t)r(e)}}),o=!!function(){try{return!!window.localStorage}catch(e){return!1}}()&&{get:function(e,t){if(null!=(e=i(e))){var n=localStorage.getItem(e);return defined(n)?n:t}for(var r={},a=0;a<localStorage.length;a++)r[localStorage.key(a)]=localStorage.getItem(localStorage.key(a));return r},set:function(e,t,n){e=i(e),localStorage.setItem(e,t)},del:function(e){e=i(e),localStorage.removeItem(e)},setJson:function(e,t){e=i(e),localStorage.setItem(e,JSON.stringify(t))},getJson:function(e){var t=this.get(e);return!!defined(t)&&JSON.parse(t)},clear:function(){for(var e=0;e<localStorage.length;e++)localStorage.removeItem(localStorage.key(e))}};return{parent:e,modules:{Cookie:a,LS:o}}}),define("DynTmpl",["Lexer",FunEx],function(e,t){"use strict";function n(e){return this.variable[e]}function r(e,t){this.variable[e]!=t&&(this.variable[e]=t,null==this._date.updateQueued&&(this._date.updateQueued=setTimeout(this.update.bind(this),0)))}var i=!0;if(!Object.defineProperty&&(i=!1,!Object.__defineGetter__))throw new Error("抱歉, 您的浏览器不支持");function a(e,o,s){for(var l in(e=t(e)).removeChildren().html(a.execute(o,s)),this._date={elem:e,tmpl:o,updateQueued:null},this.variable={},s)this.variable[l]=s[l],i?Object.defineProperty(this,l,{configurable:!1,enumerable:!0,get:n.bind(this,l),set:r.bind(this,l)}):(this.__defineGetter__(l,n.bind(this,l)),this.__defineSetter__(l,r.bind(this,l)))}function o(e){function t(e,t,n){var r;do{r=e,e=e.replace(t,n)}while(r!=e);return e}return t(e=t(e=t(e=t(e=t(e,/^ /g,""),/ $/g,""),/^\t/g,""),/\t$/g,""),/[\r\n]/g,"")}a.prototype.destory=function(){delete this._date,delete this.variable},a.prototype.update=function(){var e=a.execute(this._date.tmpl,this.variable);this._date.elem.removeChildren().html(e),this._date.updateQueued=null},a.prototype.set=function(e,t){if(defined(t))this.variable[e]=t;else for(var n in e)this.variable[n]=e[n];null==this._date.updateQueued&&(this._date.updateQueued=setTimeout(this.update.bind(this),0))},a.parseOnce=function(e,n,r){var i=a.execute(n,r);t(e).removeChildren().html(i)},a.execute=function(e,t){var n,r=a.compile(e,t);try{n=r(t)}catch(t){console.error("[DynTmpl] 模板",e,"遇到错误",t,r),n="模板"+e+"遇到错误, 请查看控制台!"}return n},a.defineTemplate=function(e,t){c[e]=o(s)};var l={},c={},f={head:"''",before:"霼+=",after:";",foot:"霼"},u=/^[a-zA-Z\$][0-9a-zA-Z\$]+$/;function d(t){return t.length?f.before+'"'+e.addSlashes(t)+'"'+f.after:""}function h(e){return f.before+e+f.after}return a.compile=function(e,n,r){if(defined(l[e]))return l[e][r?1:0];var i="var 霼="+f.head+";";for(var s in n){if(!u.test(s))throw new Error("Illegal variable name: "+s);i+="var "+s+"=data['"+s+"'];"}var p=function(e){if(!defined(c[e])){c={};for(var n=t('script$type="text/tmpl"'),r=0;r<n.length;r++)c[n.eq(r).attr("data-name")]=o(n.eq(r).html())}return c[e]}(e);if(!defined(p))throw new Error("Unknwon template name "+e);var m="",v=p.split("<%"),g=[];if(v.forEach(function(e){var t=(e=e.split("%>"))[0],r=e[1];defined(r)?m+=function(e,t,n){if("="==(e=e.trim().split(" "))[0][0]){var r=e[0].substring(1);return e.shift(),h(r+=e.join(" "))}if(1==e.length)return function(e,t){switch(e){case"/if":return"}";case"else":return"} else {";case"/foreach":case"/for":return t.pop(),"}";default:throw new Error("Unknown keyword "+e)}}(e[0],n);var i;switch(i=e.shift()){case"=":return h(e.join(" "));case"if":return"if("+e.join("")+"){";case"foreach":if("as"!=e[1])throw new Error("Unknown keyword "+e[1]+" in foreach statement.");n.push(e[2]);var o=String.fromCharCode(64+n.length);return"for(var "+o+" in "+e[0]+"){var "+e[2]+"="+e[0]+"["+o+"];";case"for":return e=e.join("").split(";"),n.push(e[0]),"for(var "+e[0]+";"+e[1]+";"+e[2]+"){";case"template":return a.compile(e[0],t,!0);case"echo":return h(e.join(" "));case"eval":return e.join(" ")+";";default:throw new Error("Unknown keyword "+i)}}(t,n,g)+d(r):m+=d(t)}),g.length>0)throw new Error("Unclosed statement.");return(l[e]=[new Function("data",i+m+"return "+f.foot+";"),m])[r?1:0]},t.extend(t,{Tpl:a}),{modules:a}}),function(e,t){"use strict";String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){try{var n=new RegExp(e,"g");return this.replace(n,t)}catch(e){}var r,i=this;do{r=i,i=i.replace(e,t)}while(r!==i);return i},e.callOnly(String.prototype,["replaceAll"])),e(t).once("load",function(){for(var t=e.onReady.loaded,n=0;n<t.length;n++)t[n]();delete e.onReady.loaded})}(FunEx,window);define("Date",[],function(){"use strict";var n=["天","一","二","三","四","五","六"];function t(n,t){return String(n).padStart(t,"0")}return{parent:"FunEx",modules:{StampToDate:function(e,r){var i=defined(r)?new Date(1e3*parseInt(r,10)):new Date,o={L:function(){var n=o.Y();return 0==(3&n)&&(n%100||0==n%400)?1:0},Y:function(){return i.getFullYear()},y:function(){return String(i.getFullYear()).slice(2)},d:function(){return t(o.j(),2)},j:function(){return i.getDate()},l:function(){return"星期"+n[o.w()]},w:function(){return i.getDay()},N:function(){return o.w()+1},m:function(){return t(o.n(),2)},n:function(){return i.getMonth()+1},t:function(){var n;return 2==(n=i.getMonth()+1)?28+o.L():(n=0!=(1&n))&&n<8||!n&&n>7?31:30},a:function(){return i.getHours()>11?"pm":"am"},A:function(){return o.a().toUpperCase()},g:function(){return i.getHours()%12||12},G:function(){return i.getHours()},h:function(){return t(o.g(),2)},H:function(){return t(i.getHours(),2)},i:function(){return t(i.getMinutes(),2)},s:function(){return t(i.getSeconds(),2)},O:function(){var n=t(Math.abs(i.getTimezoneOffset()/60*100),4);return n=i.getTimezoneOffset()>0?"-"+n:"+"+n},P:function(){var n=o.O();return n.substr(0,3)+":"+n.substr(3,2)},c:function(){return o.Y()+"-"+o.m()+"-"+o.d()+"T"+o.H()+":"+o.i()+":"+o.s()+o.P()},U:function(){return Math.round(i.getTime()/1e3)}};return e.replace(/[\\]?([a-zA-Z])/g,function(n,t){return n==t&&o[t]?o[t]():t})},getUnix:function(){return parseInt(Date.now()/1e3,10)}}}});

$(function(){
/* * @copyright roj234 */"use strict";window._config = {server: "./"};

var ui = window.ui = {};
ui.displayDate = function(info) {
return $.StampToDate("Y-m-d H:i:s", info.begin) + " —— " + $.StampToDate("Y-m-d H:i:s", info.end);
};

ui.ipString = function(ip) {
ip = parseInt(ip, 10);
return (ip >>> 24 & 255) + "." + (ip >>> 16 & 255) + "." + (ip >>> 8 & 255) + "." + (ip & 255);
};

ui.stringIp = function(ip) {
ip = ip.split(".");
return parseInt(ip[0]) << 24 | parseInt(ip[1]) << 16 | parseInt(ip[2]) << 8 | parseInt(ip[3]);
};

ui.showError = function(info, timeout, uncloseable) {
return notify("×", "error", info, timeout, uncloseable);
};

ui.showWarning = function(info, timeout, uncloseable) {
return notify("!", "warning", info, timeout, uncloseable);
};

ui.showNotification = function(info, timeout, uncloseable) {
return notify("i", "info", info, timeout, uncloseable);
};

function notify(icon, clazz, message, timeout=5e3, uncloseable=false) {
var holder = $(".notifications");
if(holder[0].childElementCount >= 10) {
ui.closeNotification(holder.find("div!.clr(0)").addClass("clr").find("div"));
}

var elem = $('<div>').addClass("box").addClass('noSel').html('<div class="notify"><span class="icon ' + clazz + '">' + icon + '</span><span class="body" style="box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 5px;"><span class="message"></span></span>' + (uncloseable ? '' : '<a class="close" href="#" onclick="ui.closeNotification($(this).parent());return false;">×</a>') + '<div style="clear: both"></div></div>').appendTo(holder).child(0);

elem._parent.find("div .body .message").append(message);

function close() {
ui.closeNotification(elem);
}
if(-1 !== timeout)
setTimeout(close, timeout > 1100 ? timeout : 5e3);
return {
close: close, 
value: function(text) {
elem.child(1).child(0).html(text);
}
};
}

ui.closeNotification = function(elem) {
var w = Math.max(elem.width() * 3, 700);
elem.css("width", elem.width() + "px").delay(10).css("transition", "width "+ (w / 1000) + "s ease").delay(10).css("width", "2.75rem")
.find('.close').hide();
setTimeout(function() {
elem.child(1).css("visibility", "hidden");
elem.parent().fadeOut(600).remove();
elem.child(0).css({"transform":"scale(0)","transition":"transform .5s ease"});
}, 150 + w);
};

function a(){$(".body_div",".body_div .r").css("height",$(window).height()-1-(_config.isMobile?48:88)+"px")}
function e(){$("body").addClass("dark"),$("#day_night i").removeClass("fa-moon-o").addClass("fa-sun-o").parent().removeClass("btn-dark").addClass("btn-light")}$(window).on("resize",a,!1,{passive:!0}),a(),$("#day_night").on("click",function(a){var s=$("#day_night i");s.hasClass("fa-sun-o")?($("body").removeClass("dark"),$.LS.del("dark"),s.removeClass("fa-sun-o").addClass("fa-moon-o").parent().removeClass("btn-light").addClass("btn-dark")):($.LS.set("dark",1),e())}).if(_config.isMobile).remove().appendTo(".top"),$.LS.get("dark")&&e(),a(),$("body").delegateChild("click",".custom-box label",function(a){var e=$(a.delegatedTarget);if(this.hasClass("radio")){if(!e.hasClass("toggled")){var s=this.data("id");defined(s)&&""!=s?$(".custom-box$data-id='"+s+"' label").removeClass("toggled"):this.find("label").removeClass("toggled"),e.addClass("toggled")}}else e.toggleClass("toggled")});

let ws;
_config.websocketFn = function(callback) {
	if (ws) {
		ws.close();
		return;
	}

	ws = new WebSocket("ws:"+location.href.substring(location.protocol.length));
	ws.binaryType = "arraybuffer";
	ws.onmessage = function(e) {
		callback("msg", e.data);
	};
	ws.onopen = function() {
		callback("open");
	};
	ws.onclose = function(e) {
		callback("close", e.code+"@"+e.reason);
		ws = null;
	};
	return ws.send.bind(ws);
};

ui.v = function() {
	let v = {};
	let ws;
	let modifier = {
		"BUTTON": (el,data) => {
			let span = el.el.find("span");
			(span||el.el)[data._=="update"?"html":"append"](data.value);
		},
		"TBODY":(el,data) => {
			if (!el.tmpl) {
				el.tmpl = new $.Tpl(el.el, el.el.attr("v-template"),{data:[]});
			}
			el.tmpl.data = data.value;
		},
	};

	let inputLike1 = (el,data) => {
		el.el[data._=="update"?"val":"append"](data.value);
	};
	modifier["INPUT"] = modifier["TEXTAREA"] = inputLike1;
	let setHtml = (el,data) => {
		el.el[data._=="update"?"html":"append"](data.value);
	};

	let apply = {
		"BUTTON": (el) => {
			el.on("click", function(e) {
				send({"_":"click","id":e.target.getAttribute("v-id"),"value":e.target.value});
			});
		}
	};

	let inputLike = (el) => {
		el.on("change", function(e) {
			send({"_":"change","id":e.target.getAttribute("v-id"),"value":e.target.value});
		});
	};
	apply["INPUT"] = apply["TEXTAREA"] = apply["SELECT"] = inputLike;

	let dialog = ui.showNotification($("<a>").html("点击连接服务器").on("click", init), -1, true);
	document.querySelectorAll("[v-id]").forEach((el) => {
		v[el.getAttribute("v-id")] = {
			el: $(el),
			type: el.nodeName
		};
		if (apply[el.nodeName]) apply[el.nodeName]($(el));
	});

	function send(obj) {
		ws&&ws(JSON.stringify(obj));
	}

	function init() {
		ws = _config.websocketFn((kind, data) => {
			switch (kind) {
				case "close":
					dialog = ui.showNotification($("<a>").html(data+", 重新连接").on("click", init), -1, true);
				break;
				case "open":
					dialog.close();
				break;
				case "msg":
					data = JSON.parse(data);
					let el = v[data.id];
					if (!el) {
						ui.showError("V-el missing: " + data.id);
						return;
					}
					(modifier[el.type]||setHtml)(el,data);
				break;
			}
		});
	}
};

});